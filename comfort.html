<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Comfort Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* ================= 1. BASE VARIABLES ================= */
        :root {
            /* Colors */
            --bg-color: #fdf2f8;
            --card-bg: #ffffff;
            --primary: #db2777;
            --secondary: #fbcfe8;
            --text-main: #4a4a4a;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.025);
            --sick-accent: #6366f1;

            /* Bubbles & Particles */
            --bubble-gradient: radial-gradient(circle at 30% 30%, #ffdff0, #db2777);
            --popped-color: #fce7f3;
            --particle-icon: '‚ù§Ô∏è';
            --card-border: rgba(255, 255, 255, 0.5);

            /* Message Box Specific Text Color (Defaults to dark grey) */
            --msg-text: #4a4a4a;
        }

        /* ================= 2. THEME OVERRIDES ================= */

        /* --- GOTH PROTOCOL --- */
        body.theme-goth {
            --bg-color: #120a18;
            --card-bg: #1e1e24;
            --primary: #ff521a;
            /* Pumpkin Orange */
            --secondary: #4a148c;
            --text-main: #e0e0e0;
            --shadow: 0 10px 20px -3px rgba(0, 0, 0, 0.9);
            --sick-accent: #d32f2f;
            /* Blood Red */
            --bubble-gradient: radial-gradient(circle at 30% 30%, #ff8a50, #d32f2f);
            --popped-color: #2a0a0a;
            --particle-icon: 'ü¶á';
            --card-border: rgba(255, 255, 255, 0.1);

            /* Text Color Fix: Orange */
            --msg-text: #ff521a;
        }

        /* --- ZELDA MODE --- */
        body.theme-zelda {
            --bg-color: #2c3e50;
            /* Dark Slate Blue */
            --card-bg: #f5e6c8;
            /* Light Parchment */
            --primary: #8d6e63;
            /* Leather Brown */
            --secondary: #fde047;
            --text-main: #3e2723;
            /* Dark Brown (For Cards) */
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            --sick-accent: #c0392b;
            --bubble-gradient: radial-gradient(circle at 30% 30%, #81f79f, #2ecc71);
            --popped-color: #d7ccc8;
            --particle-icon: 'üî∫';
            --card-border: #8d6e63;

            /* Text Color Fix: Light Parchment */
            --msg-text: #f5e6c8;
        }

        /* Header text override for Zelda mode */
        body.theme-zelda header h1,
        body.theme-zelda header p.subtitle {
            color: #f5e6c8 !important;
        }

        /* --- CHILL/WEED MODE --- */
        body.theme-weed {
            --bg-color: #0f1712;
            --card-bg: #14281d;
            --primary: #4ade80;
            --secondary: #14532d;
            --text-main: #d1fae5;
            --shadow: 0 10px 20px -3px rgba(0, 0, 0, 0.6);
            --sick-accent: #84cc16;
            --bubble-gradient: radial-gradient(circle at 30% 30%, #86efac, #22c55e);
            --popped-color: #064e3b;
            --particle-icon: 'üí®';
            --card-border: rgba(74, 222, 128, 0.2);

            /* Text Color Fix: Neon Green */
            --msg-text: #4ade80;
        }

        /* ================= 3. LAYOUT & ANIMATION ================= */
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 90vh;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.6s ease, color 0.6s ease;
        }

        .container {
            max-width: 400px;
            width: 100%;
            z-index: 10;
            position: relative;
        }

        /* --- THEME BAR --- */
        .theme-bar {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.05);
            padding: 8px;
            border-radius: 50px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--card-border);
            z-index: 20;
            position: relative;
        }

        .theme-btn {
            background: transparent;
            border: 2px solid transparent;
            font-size: 1.4rem;
            cursor: pointer;
            padding: 5px 12px;
            border-radius: 20px;
            transition: all 0.2s;
            opacity: 0.5;
            filter: grayscale(0.5);
        }

        .theme-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .theme-btn.active {
            opacity: 1;
            filter: grayscale(0);
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* --- DECOR: ZELDA FAIRIES & SHIELD --- */
        .zelda-shield {
            display: none;
            width: 60px;
            height: auto;
            margin: 0 auto 15px auto;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
            animation: floatShield 3s ease-in-out infinite;
        }

        body.theme-zelda .zelda-shield {
            display: block;
        }

        @keyframes floatShield {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        /* The Navi Fairies */
        .fairy-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 1s;
            z-index: 1;
        }

        body.theme-zelda .fairy-container {
            opacity: 1;
        }

        .fairy {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 10px #fff, 0 0 20px var(--primary), 0 0 30px var(--secondary);
            animation: flyAround 15s infinite linear;
        }

        .fairy::before,
        .fairy::after {
            content: '';
            position: absolute;
            top: -5px;
            width: 14px;
            height: 20px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: flutter 0.1s infinite alternate;
        }

        .fairy::before {
            left: -10px;
            transform: rotate(-20deg);
        }

        .fairy::after {
            right: -10px;
            transform: rotate(20deg);
        }

        .fairy:nth-child(1) {
            top: 20%;
            left: 10%;
            animation-duration: 12s;
        }

        .fairy:nth-child(2) {
            top: 70%;
            right: 10%;
            animation-duration: 18s;
            animation-delay: -5s;
            --primary: #00ffff;
        }

        @keyframes flutter {
            from {
                transform: scaleX(1);
            }

            to {
                transform: scaleX(0.5);
            }
        }

        @keyframes flyAround {
            0% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(50px, -50px);
            }

            50% {
                transform: translate(0, -100px);
            }

            75% {
                transform: translate(-50px, -50px);
            }

            100% {
                transform: translate(0, 0);
            }
        }

        /* --- DECOR: CANDLES (Goth) --- */
        .decor-container {
            position: absolute;
            top: 0;
            height: 100px;
            width: 60px;
            opacity: 0;
            transition: opacity 1s ease;
            pointer-events: none;
        }

        .decor-left {
            left: -30px;
        }

        .decor-right {
            right: -30px;
        }

        body.theme-goth .decor-container.candle-mode {
            opacity: 1;
        }

        body.theme-weed .decor-container.smoke-mode {
            opacity: 1;
        }

        .candle-art {
            position: absolute;
            bottom: 0;
            width: 15px;
            height: 35px;
            background: linear-gradient(to right, #e0c097, #bfa07a);
            border-radius: 3px;
            box-shadow: 20px 10px 0 #e0c097, -18px 15px 0 #bfa07a;
            left: 20px;
        }

        .candle-art::before,
        .candle-art::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 12px;
            background: radial-gradient(ellipse at bottom, #ffdb3b, #ff521a);
            border-radius: 50% 50% 35% 35%;
            top: -12px;
            left: 4px;
            animation: flicker 0.1s infinite alternate;
        }

        .candle-art::after {
            top: -2px;
            left: 24px;
            animation-delay: 0.05s;
        }

        @keyframes flicker {
            from {
                transform: scale(1);
                opacity: 0.9;
            }

            to {
                transform: scale(1.1, 0.9);
                opacity: 1;
            }
        }

        /* --- DECOR: CIGARETTES/JOINTS (Weed) --- */
        .cig-art {
            position: absolute;
            bottom: 10px;
            left: 20px;
            width: 8px;
            height: 50px;
            background: linear-gradient(to right, #f5f5f5, #e0e0e0);
            border-radius: 2px;
            transform-origin: bottom center;
            transform: rotate(-10deg);
        }

        .cig-art::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: radial-gradient(circle, #ff5e00, #ff0000);
            border-radius: 2px 2px 0 0;
            box-shadow: 0 -2px 5px #ff5e00;
            animation: burn 0.2s infinite alternate;
        }

        .smoke-puff {
            position: absolute;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, rgba(200, 200, 200, 0.6) 0%, transparent 70%);
            border-radius: 50%;
            top: -10px;
            left: -5px;
            animation: smokeRise 2.5s infinite;
            filter: blur(3px);
            opacity: 0;
        }

        .smoke-puff:nth-child(2) {
            animation-delay: 0.8s;
            width: 25px;
            height: 25px;
        }

        .smoke-puff:nth-child(3) {
            animation-delay: 1.6s;
            width: 15px;
            height: 15px;
        }

        @keyframes burn {
            from {
                opacity: 0.8;
            }

            to {
                opacity: 1;
                box-shadow: 0 -3px 8px #ff9100;
            }
        }

        @keyframes smokeRise {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 0.5;
            }

            100% {
                transform: translateY(-60px) scale(2.5);
                opacity: 0;
            }
        }

        /* --- GENERAL UI --- */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-top: 10px;
        }

        .recovery-badge {
            background-color: var(--sick-accent);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
            transition: background-color 0.5s ease;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        h1 {
            color: var(--primary);
            font-size: 1.8rem;
            margin: 5px 0;
            transition: color 0.5s ease;
        }

        p.subtitle {
            font-size: 0.9rem;
            color: var(--text-main);
            opacity: 0.7;
            margin-top: 0;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--card-border);
            text-align: center;
            transition: background-color 0.5s ease, box-shadow 0.5s ease, border 0.5s ease;
        }

        .card h2 {
            font-size: 1.3rem;
            margin-top: 0;
            color: var(--primary);
            margin-bottom: 15px;
            transition: color 0.5s ease;
        }

        #message-box {
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--msg-text);
            /* Theme specific color */
            margin-bottom: 20px;
            font-style: italic;
            padding: 10px;
            background: var(--bg-color);
            border-radius: 15px;
            transition: all 0.3s ease;
            border: 1px solid var(--card-border);
        }

        .btn-main {
            display: block;
            width: 100%;
            padding: 18px;
            background-color: var(--primary);
            color: white;
            text-align: center;
            text-decoration: none;
            border: none;
            border-radius: 15px;
            font-weight: 700;
            font-size: 1rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        body.theme-zelda .btn-main {
            color: white;
        }

        body.theme-weed .btn-main {
            color: #022c22;
        }

        .btn-main:active {
            transform: scale(0.96);
        }

        .btn-secondary {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background-color: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 15px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:active {
            background-color: var(--secondary);
            transform: scale(0.98);
        }

        /* ================= 4. BUBBLES ================= */
        .bubble-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-top: 15px;
            padding: 5px;
        }

        .bubble {
            width: 100%;
            padding-bottom: 100%;
            background: var(--bubble-gradient);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 5px rgba(0, 0, 0, 0.2);
            position: relative;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }

        /* Goth Pumpkin */
        body.theme-goth .bubble {
            border-radius: 40% 40% 50% 50%;
            background-image:
                repeating-linear-gradient(90deg, transparent, transparent 15%, rgba(0, 0, 0, 0.15) 15%, rgba(0, 0, 0, 0.15) 17%),
                radial-gradient(circle at 30% 30%, #ff8a50, #d32f2f);
        }

        body.theme-goth .bubble::before {
            content: '';
            position: absolute;
            top: -12%;
            left: 42%;
            width: 16%;
            height: 15%;
            background: #4a2c2a;
            border-radius: 4px 4px 0 0;
        }

        /* Zelda Rupee */
        body.theme-zelda .bubble {
            border-radius: 0;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            background-image: linear-gradient(135deg, rgba(255, 255, 255, 0.6) 0%, transparent 50%);
            filter: drop-shadow(0 4px 2px rgba(0, 0, 0, 0.4));
        }

        /* Weed Leaf */
        body.theme-weed .bubble {
            border-radius: 0 50% 50% 50%;
            transform: rotate(45deg);
            margin: 2px;
            box-shadow: none;
            filter: drop-shadow(0 4px 2px rgba(0, 0, 0, 0.5));
        }

        .bubble.popped {
            background: var(--popped-color) !important;
            box-shadow: inset 0 3px 5px rgba(0, 0, 0, 0.3);
            transform: scale(0.8) !important;
            opacity: 0.6;
            background-image: none !important;
            clip-path: none !important;
            border-radius: 50% !important;
            filter: none !important;
        }

        body.theme-goth .bubble.popped {
            box-shadow: inset 0 0 15px var(--primary);
        }

        body.theme-goth .bubble.popped::before {
            display: none;
        }

        /* ================= 5. EXTRAS ================= */
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .status-btn {
            padding: 15px 10px;
            border-radius: 12px;
            text-align: center;
            font-size: 0.9rem;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px solid transparent;
            transition: 0.2s;
            color: var(--text-main);
            background: var(--bg-color);
            border: 1px solid var(--card-border);
        }

        .status-discord {
            color: #5865F2;
        }

        .status-btn:active {
            transform: scale(0.98);
        }

        .note {
            font-size: 0.8rem;
            text-align: center;
            color: var(--text-main);
            opacity: 0.6;
            margin-top: 30px;
        }

        .heart-particle {
            position: absolute;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            font-size: 1.2rem;
            z-index: 99;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) rotate(0deg) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(-50px) rotate(20deg) scale(1.5);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <div class="fairy-container">
        <div class="fairy"></div>
        <div class="fairy"></div>
    </div>

    <div class="container">

        <div class="decor-container candle-mode decor-left">
            <div class="candle-art"></div>
        </div>
        <div class="decor-container candle-mode decor-right">
            <div class="candle-art" style="transform: scaleX(-1);"></div>
        </div>

        <div class="decor-container smoke-mode decor-left">
            <div class="cig-art">
                <div class="smoke-puff"></div>
                <div class="smoke-puff"></div>
                <div class="smoke-puff"></div>
            </div>
        </div>
        <div class="decor-container smoke-mode decor-right" style="transform: scaleX(-1);">
            <div class="cig-art">
                <div class="smoke-puff"></div>
                <div class="smoke-puff"></div>
                <div class="smoke-puff"></div>
            </div>
        </div>

        <div class="theme-bar">
            <button class="theme-btn active" onclick="setTheme('healing')" title="Healing">ü©π</button>
            <button class="theme-btn" onclick="setTheme('goth')" title="Goth">ü¶á</button>
            <button class="theme-btn" onclick="setTheme('zelda')" title="Zelda">‚öîÔ∏è</button>
            <button class="theme-btn" onclick="setTheme('weed')" title="Chill">üåø</button>
        </div>

        <header>
            <img src="zeldashield.png" class="zelda-shield" alt="Zelda Shield">

            <div class="recovery-badge" id="badge-text">ü©π Currently: Healing Mode</div>
            <h1 id="title-text">Protocol: Comfort</h1>
            <p class="subtitle" id="subtitle-text">Because you're sick and nature is rude.</p>
        </header>

        <div class="card">
            <h2 id="validation-title">‚ú® Emergency Validation</h2>
            <p style="color: var(--text-main); opacity: 0.7; font-size: 0.9rem;">Tap for instant affection.</p>

            <div id="message-box">"Tap below to receive love."</div>

            <button class="btn-main" onclick="dispenseLove()" id="btn-main-text">
                üíñ Dispense Yellow Medicine (aka Love)
            </button>
        </div>

        <div class="card">
            <h2 id="wrap-title">üßº Stress Relief Wrap</h2>
            <p style="color: var(--text-main); opacity: 0.7; font-size: 0.9rem;">Pop to relieve anxiety.</p>

            <div class="bubble-grid" id="bubble-wrap"></div>

            <button class="btn-secondary" onclick="generateBubbles()">
                üîÑ Reset Bubbles
            </button>
        </div>

        <div class="card">
            <h2>üì° Connection Status</h2>
            <p style="color: var(--text-main); opacity: 0.7; font-size: 0.9rem;">
                I am here if you need me, but I will let you rest if you don't.
            </p>
            <div class="status-grid">
                <a href="sms:+15550000000?body=I feel gross and I need to sleep. Talk to you later." class="status-btn">
                    <span style="font-size: 1.5em">ü§í</span> Too Sick / Sleep
                </a>
                <a href="https://discord.com/users/320165150529421313" class="status-btn status-discord">
                    <span style="font-size: 1.5em">üéÆ</span> Go to Discord
                </a>
            </div>
        </div>

        <div class="note">Get well soon, my love.<br>Made by Brofresco</div>
    </div>

    <script>
        /* ----- 1. MESSAGES ----- */
        const messages = {
            healing: [
                "I hate that you are feeling bad and I hate being far away.",
                "You are the most beautiful girl in the world, even when you feel gross. I Swurrrr!!",
                "It is okay to rot in bed today. I support your rotting.",
                "You don't have to 'fix' how you feel right now. Just exist.",
                "I wish I could teleport there just to rub your back.",
                "You are smarter than your stress, even if it doesn't feel like it.",
                "I am obsessed with you. Period.",
                "Sending virtual heating pads and zero-calorie chocolate.",
                "You vs The Cold? My money is on you. Always.",
                "I Swurrrr",
                "Snot is temporary, but your cuteness is forever.",
                "Germs are just jealous of you. Honestly, can't blame them.",
                "I'm filing a lawsuit against your immune system for negligence.",
                "Warning: You are currently too hot, so your body gave you a fever to match.",
                "Please drink water. If you don't, I will telepathically annoy you I Swurrrrr.",
                "If I was there, I would fight the bacteria for you. Physically.",
                "Being sick is illegal. I'm calling the police.",
                "Even with a stuffed nose, you're still the best looking person I know.",
                "Gross feelings are banned. I don't make the rules (actually I do).",
                "I promise to still kiss you when you aren't a biohazard.",
                "System update: Healing in progress... 99%...",
                "Don't worry, you'll be back to bossing me around in no time."
            ],
            goth: [
                "The void stares back and thinks you're cute.", "Crypt keeper mode activated.",
                "Let's summon a demon to fight your cold.", "Every cough is just a bat leaving your soul.",
                "You look beautiful even when you feel like a goblin.", "Darkness embraces you (comfortably).",
                "Gross feelings are banned.", "I promise to kiss you when you aren't a biohazard."
            ],
            zelda: [
                "It's dangerous to go alone! Take my love.", "You found a Piece of Heart! ‚ù§Ô∏è",
                "Hey! Listen! Drink some water!", "Hyrule needs you healthy.",
                "Playing the Song of Healing... üé∂", "A fairy is reviving you right now.",
                "Rey is gay, so is Allie",
                "Smashing pots (and your cold).", "You are a warrior princess. This cold is just a level 1 slime."
                
            ],
            weed: [
                "Puff puff pass the love. üí®", "You're dope. Literally.",
                "High on affection right now.", "Chill mode: Maximum.",
                "Medicinal use only (for the soul).", "Sending good vibes and snacks.",
                "Don't panic, it's organic (my love for you).", "Rest your eyes, smoke (soup) everyday."
            ]
        };

        /* ----- 2. COLOR PALETTES ----- */
        const defaultPalettes = [
            { grad: 'radial-gradient(circle at 30% 30%, #ffdff0, #db2777)', pop: '#fce7f3' }, // Pink
            { grad: 'radial-gradient(circle at 30% 30%, #e0f2fe, #0284c7)', pop: '#e0f2fe' }, // Blue
            { grad: 'radial-gradient(circle at 30% 30%, #dcfce7, #16a34a)', pop: '#dcfce7' }, // Green
            { grad: 'radial-gradient(circle at 30% 30%, #f3e8ff, #9333ea)', pop: '#f3e8ff' }, // Purple
            { grad: 'radial-gradient(circle at 30% 30%, #ffedd5, #ea580c)', pop: '#ffedd5' }  // Orange
        ];

        const rupees = [
            'radial-gradient(circle at 30% 30%, #81f79f, #2ecc71)', // Green
            'radial-gradient(circle at 30% 30%, #85c1e9, #3498db)', // Blue
            'radial-gradient(circle at 30% 30%, #f7dc6f, #d4ac0d)', // Gold
            'radial-gradient(circle at 30% 30%, #f1948a, #e74c3c)'  // Red
        ];

        /* ----- 3. STATE ----- */
        let currentTheme = 'healing';
        // Start at -1 so the first load (init) makes it 0 (Pink)
        let defaultPaletteIndex = -1;

        function setTheme(theme) {
            currentTheme = theme;

            // Clean Body Classes
            document.body.classList.remove('theme-goth', 'theme-zelda', 'theme-weed');
            if (theme !== 'healing') document.body.classList.add(`theme-${theme}`);

            // Update Active Button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.onclick.toString().includes(theme)) btn.classList.add('active');
            });

            // Update Text UI
            const ui = {
                healing: { badge: "ü©π Healing Mode", title: "Protocol: Comfort", sub: "Nature is rude.", btn: "üíñ Dispense Love", wrap: "üßº Stress Relief" },
                goth: { badge: "ü¶á Goth Protocol", title: "Protocol: Crypt Comfort", sub: "The void calls.", btn: "üñ§ Dark Affection", wrap: "üéÉ Pumpkin Smash" },
                zelda: { badge: "‚öîÔ∏è Zelda Mode", title: "Protocol: Hyrule", sub: "It's dangerous to go alone.", btn: "üíé Open Chest", wrap: "üí∞ Rupee Smash" },
                weed: { badge: "üåø Chill Mode", title: "Protocol: 420", sub: "Good vibes only.", btn: "üí® Hit This (Button)", wrap: "üçÉ Pop Leaves" }
            };

            const t = ui[theme];
            document.getElementById('badge-text').innerText = t.badge;
            document.getElementById('title-text').innerText = t.title;
            document.getElementById('subtitle-text').innerText = t.sub;
            document.getElementById('btn-main-text').innerText = t.btn;
            document.getElementById('wrap-title').innerText = t.wrap;

            generateBubbles();
        }

        function dispenseLove() {
            const box = document.getElementById('message-box');
            const pool = messages[currentTheme];
            const msg = pool[Math.floor(Math.random() * pool.length)];

            box.style.opacity = 0;
            setTimeout(() => {
                box.innerText = msg;
                box.style.opacity = 1;
            }, 150);
        }

        function generateBubbles() {
            const container = document.getElementById('bubble-wrap');
            container.innerHTML = '';

            let grad, pop;

            if (currentTheme === 'healing') {
                defaultPaletteIndex = (defaultPaletteIndex + 1) % defaultPalettes.length;
                const p = defaultPalettes[defaultPaletteIndex];
                grad = p.grad; pop = p.pop;
            } else if (currentTheme === 'goth') {
                // Force orange for pumpkins, stripes handled by CSS class
                grad = 'radial-gradient(circle at 30% 30%, #ff8a50, #d32f2f)'; pop = '#2a0a0a';
            } else if (currentTheme === 'weed') {
                grad = 'radial-gradient(circle at 30% 30%, #86efac, #22c55e)'; pop = '#065f46';
            } else {
                grad = ''; pop = '#d1d5db';
            }

            document.documentElement.style.setProperty('--bubble-gradient', grad);
            document.documentElement.style.setProperty('--popped-color', pop);

            for (let i = 0; i < 20; i++) {
                const bubble = document.createElement('div');
                bubble.className = 'bubble';

                if (currentTheme === 'zelda') {
                    bubble.style.background = rupees[Math.floor(Math.random() * rupees.length)];
                } else if (currentTheme !== 'goth') {
                    bubble.style.background = ''; // reset for others, Goth uses CSS layering
                }

                bubble.onclick = function () {
                    if (!this.classList.contains('popped')) {
                        this.classList.add('popped');
                        if (navigator.vibrate) navigator.vibrate(50);
                    }
                };
                container.appendChild(bubble);
            }
        }

        /* ----- PARTICLES ----- */
        document.addEventListener('click', function (e) {
            if (['BUTTON', 'A', 'LABEL', 'INPUT'].includes(e.target.tagName) || e.target.classList.contains('bubble')) return;

            const p = document.createElement('div');
            p.className = 'heart-particle';

            const style = getComputedStyle(document.body);
            p.innerText = style.getPropertyValue('--particle-icon').replace(/['"]/g, '').trim();

            p.style.left = e.pageX + 'px';
            p.style.top = e.pageY + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1000);
        });

        // Initialize
        generateBubbles();
    </script>
</body>

</html>